<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Least Squares Regression Applet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        
        .input-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .data-input {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e9ecef;
        }
        
        .data-input h3 {
            margin-top: 0;
            color: #495057;
            text-align: center;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
            margin-bottom: 15px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 120px;
            resize: vertical;
            font-family: monospace;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 0 10px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .clear-btn {
            background: #6c757d;
        }
        
        .clear-btn:hover {
            background: #545b62;
        }
        
        .results {
            margin-bottom: 30px;
        }
        
        .equation {
            background: #e7f3ff;
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #0056b3;
            margin-bottom: 15px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #007bff;
            text-align: center;
        }
        
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #495057;
            margin-top: 5px;
        }
        
        .chart-container {
            position: relative;
            height: 500px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            box-sizing: border-box;
        }
        
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .instructions {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Least Squares Regression Analysis</h1>
        
        <div class="instructions">
            <strong>Instructions:</strong> Enter your data variable names and numerical values separated by commas (e.g., 1,2,3,4,5). 
            Both datasets must have the same number of values. Click "Generate Graph" to create the scatter plot with regression line.
        </div>
        
        <div class="input-section">
            <div class="data-input">
                <h3>X Variable (Independent)</h3>
                <label for="x-name">Variable Name:</label>
                <input type="text" id="x-name" placeholder="e.g., Time" value="">
                
                <label for="x-data">Data Values:</label>
                <textarea id="x-data" placeholder="Enter comma-separated values
e.g., 1,2,3,4,5"></textarea>
            </div>
            
            <div class="data-input">
                <h3>Y Variable (Dependent)</h3>
                <label for="y-name">Variable Name:</label>
                <input type="text" id="y-name" placeholder="e.g., Distance" value="">
                
                <label for="y-data">Data Values:</label>
                <textarea id="y-data" placeholder="Enter comma-separated values
e.g., 2,4,6,8,10"></textarea>
            </div>
        </div>
        
        <div class="controls">
            <button onclick="generateGraph()">Generate Graph</button>
            <button onclick="clearAll()" class="clear-btn">Clear All</button>
        </div>
        
        <div id="error-message"></div>
        
        <div id="results" class="results" style="display: none;">
            <div id="equation" class="equation"></div>
            
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-label">Correlation (r)</div>
                    <div class="stat-value" id="correlation">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">R-squared</div>
                    <div class="stat-value" id="r-squared">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Sample Size</div>
                    <div class="stat-value" id="sample-size">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Slope</div>
                    <div class="stat-value" id="slope">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Y-intercept</div>
                    <div class="stat-value" id="intercept">-</div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="regressionChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        
        function parseData(dataString) {
            return dataString.split(',')
                           .map(x => x.trim())
                           .filter(x => x !== '')
                           .map(x => parseFloat(x))
                           .filter(x => !isNaN(x));
        }
        
        function calculateRegression(xData, yData) {
            const n = xData.length;
            
            // Calculate means
            const xMean = xData.reduce((sum, x) => sum + x, 0) / n;
            const yMean = yData.reduce((sum, y) => sum + y, 0) / n;
            
            // Calculate slope (b1) and intercept (b0)
            let numerator = 0;
            let denominator = 0;
            
            for (let i = 0; i < n; i++) {
                numerator += (xData[i] - xMean) * (yData[i] - yMean);
                denominator += (xData[i] - xMean) * (xData[i] - xMean);
            }
            
            const slope = numerator / denominator;
            const intercept = yMean - slope * xMean;
            
            // Calculate correlation coefficient
            let sumXY = 0, sumX2 = 0, sumY2 = 0;
            for (let i = 0; i < n; i++) {
                const dx = xData[i] - xMean;
                const dy = yData[i] - yMean;
                sumXY += dx * dy;
                sumX2 += dx * dx;
                sumY2 += dy * dy;
            }
            
            const correlation = sumXY / Math.sqrt(sumX2 * sumY2);
            const rSquared = correlation * correlation;
            
            return { slope, intercept, correlation, rSquared };
        }
        
        function formatNumber(num, decimals = 4) {
            if (Math.abs(num) < 0.0001 && num !== 0) {
                return num.toExponential(3);
            }
            return Number(num.toFixed(decimals));
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.innerHTML = `<div class="error">${message}</div>`;
            document.getElementById('results').style.display = 'none';
        }
        
        function clearError() {
            document.getElementById('error-message').innerHTML = '';
        }
        
        function generateGraph() {
            clearError();
            
            // Get input values
            const xName = document.getElementById('x-name').value.trim() || 'x';
            const yName = document.getElementById('y-name').value.trim() || 'y';
            const xDataString = document.getElementById('x-data').value.trim();
            const yDataString = document.getElementById('y-data').value.trim();
            
            if (!xDataString || !yDataString) {
                showError('Please enter data for both variables.');
                return;
            }
            
            // Parse data
            const xData = parseData(xDataString);
            const yData = parseData(yDataString);
            
            // Validate data
            if (xData.length < 2 || yData.length < 2) {
                showError('Please enter at least 2 data points for each variable.');
                return;
            }
            
            if (xData.length !== yData.length) {
                showError(`Data length mismatch: X has ${xData.length} values, Y has ${yData.length} values.`);
                return;
            }
            
            // Check for constant x values (would cause division by zero)
            const xRange = Math.max(...xData) - Math.min(...xData);
            if (xRange === 0) {
                showError('X values cannot all be the same (no variation in independent variable).');
                return;
            }
            
            // Calculate regression
            const { slope, intercept, correlation, rSquared } = calculateRegression(xData, yData);
            
            // Display equation
            const slopeStr = formatNumber(slope);
            const interceptStr = formatNumber(intercept);
            const interceptSign = intercept >= 0 ? '+' : '';
            
            document.getElementById('equation').innerHTML = 
                `${yName} = ${slopeStr} × ${xName} ${interceptSign} ${interceptStr}`;
            
            // Display statistics
            document.getElementById('correlation').textContent = formatNumber(correlation);
            document.getElementById('r-squared').textContent = formatNumber(rSquared);
            document.getElementById('sample-size').textContent = xData.length;
            document.getElementById('slope').textContent = formatNumber(slope);
            document.getElementById('intercept').textContent = formatNumber(intercept);
            
            // Create scatter plot with regression line
            const ctx = document.getElementById('regressionChart').getContext('2d');
            
            // Destroy existing chart
            if (chart) {
                chart.destroy();
            }
            
            // Prepare data points
            const scatterData = xData.map((x, i) => ({ x: x, y: yData[i] }));
            
            // Create regression line points
            const xMin = Math.min(...xData);
            const xMax = Math.max(...xData);
            const regressionLine = [
                { x: xMin, y: slope * xMin + intercept },
                { x: xMax, y: slope * xMax + intercept }
            ];
            
            chart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: 'Data Points',
                        data: scatterData,
                        backgroundColor: 'rgba(54, 162, 235, 0.8)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }, {
                        label: 'Regression Line',
                        data: regressionLine,
                        type: 'line',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        borderWidth: 3,
                        pointRadius: 0,
                        pointHoverRadius: 0,
                        tension: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'point'
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: xName,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: yName,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: `Scatter Plot: ${yName} vs ${xName}`,
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    return `${xName}: ${context[0].parsed.x}`;
                                },
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `${yName}: ${context.parsed.y}`;
                                    } else {
                                        return `Predicted ${yName}: ${formatNumber(context.parsed.y, 2)}`;
                                    }
                                }
                            }
                        }
                    }
                }
            });
            
            document.getElementById('results').style.display = 'block';
        }
        
        function clearAll() {
            document.getElementById('x-name').value = 'x';
            document.getElementById('y-name').value = 'y';
            document.getElementById('x-data').value = '';
            document.getElementById('y-data').value = '';
            document.getElementById('results').style.display = 'none';
            clearError();
            
            if (chart) {
                chart.destroy();
                chart = null;
            }
        }
        
        // Example data for demonstration
        function loadExample() {
            document.getElementById('x-name').value = 'Study Hours';
            document.getElementById('y-name').value = 'Test Score';
            document.getElementById('x-data').value = '1,2,3,4,5,6,7,8';
            document.getElementById('y-data').value = '45,55,60,70,75,80,85,90';
        }
        
        // Add example button
        document.addEventListener('DOMContentLoaded', function() {
            const controlsDiv = document.querySelector('.controls');
            const exampleBtn = document.createElement('button');
            exampleBtn.textContent = 'Load Example';
            exampleBtn.style.background = '#28a745';
            exampleBtn.onclick = loadExample;
            exampleBtn.onmouseover = function() { this.style.background = '#1e7e34'; };
            exampleBtn.onmouseout = function() { this.style.background = '#28a745'; };
            controlsDiv.appendChild(exampleBtn);
        });
    </script>
</body>
</html>